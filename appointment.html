<!DOCTYPE html>
<!-- Coding By CodingNepal - youtube.com/codingnepal -->
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title>Dynamic Calendar JavaScript | CodingNepal</title>
  <link rel="stylesheet" href="calender.css">
  <link rel="stylesheet" href="../location.css">
  <link rel="stylesheet" href="time.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Font Link for Icons -->

  <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />

  <script src="/js/location.js"></script>
</head>
<body>

<div id="header-placeholder"></div>

<form id="appointmentForm" method="post">
  <div class="wrapper">


    <header>
      <p class="current-date"></p>

      <div class="icons">
        <span id="prev" class="material-symbols-rounded">chevron_left</span>
        <span id="next" class="material-symbols-rounded">chevron_right</span>
      </div>
    </header>
    <div class="calendar">
      <ul class="weeks">

        <li>Man</li>
        <li>Tir</li>
        <li>Ons</li>
        <li>Tor</li>
        <li>Fre</li>
        <li>Lør</li>
        <li>Søn</li>
      </ul>


      <ul class="days"></ul>

      <button>Vælg dato</button>

    </div>

  </div>

  <div id="map"></div>
  <input type="text" id="location" placeholder="Indtast adresse" oninput="suggestAddress()">
  <div id="suggestionsContainer"></div>

  <label for="description">Begivenhedsdetaljer (max 500 tegn)</label>
  <textarea name="description" id="description" placeholder="Skriv en kort beskrivelse..." maxlength="500" required></textarea>

  <input type="hidden" id="selectedDate" name="selectedDate">

  <input type="hidden" id="selectedTime" name="selectedTime">
  <div class="dropdown">
    <button onclick="myFunction()" class="dropbtn">Vælg start tid</button>
    <div id="timeDropdown" class="dropdown-content">
      <a>10:00</a>
      <a>10:30</a>
      <a>11:00</a>
      <a>11:30</a>
      <a>12:00</a>
      <a>12:30</a>
      <a>13:00</a>
      <a>13:30</a>
      <a>14:00</a>
      <a>14:30</a>
      <a>15:00</a>
      <a>15:30</a>
      <a>16:00</a>
      <a>16:30</a>
      <a>17:00</a>
      <a>17:30</a>
      <a>18:00</a>
      <a>18:30</a>
      <a>19:00</a>
      <a>19:30</a>
      <a>20:00</a>
      <a>20:30</a>
      <a>21:00</a>
    </div>
  </div>

  <button type="submit">Send</button>

</form>



<script>


  // Use fetch to get the header content and insert it into the placeholder
  fetch('header.html')
          .then(response => response.text())
          .then(html => document.getElementById('header-placeholder').innerHTML = html);


  function myFunction() {
    document.getElementById("timeDropdown").classList.toggle("show");
  }

  // Close the dropdown menu if the user clicks outside of it
  window.onclick = function(event) {
    if (!event.target.matches('.dropbtn')) {
      var dropdowns = document.getElementsByClassName("dropdown-content");
      var i;
      for (i = 0; i < dropdowns.length; i++) {
        var openDropdown = dropdowns[i];
        if (openDropdown.classList.contains('show')) {
          openDropdown.classList.remove('show');
        }
      }
    }
  }

</script>
<script>
  var clickedDay;

  const daysTag = document.querySelector(".days"),
          currentDate = document.querySelector(".current-date"),
          prevNextIcon = document.querySelectorAll(".icons span");

  // getting new date, current year and month
  let date = new Date(),
          currYear = date.getFullYear(),
          currMonth = date.getMonth();

  // storing full name of all months in array
  const months = ["Januar", "Februar", "Marts", "April", "Maj", "Juni", "Juli",
    "August", "September", "Oktober", "November", "December"];

  const renderCalendar = () => {
    let firstDayofMonth = new Date(currYear, currMonth, 0).getDay(), // getting first day of month /0 i stedet for 1
            lastDateofMonth = new Date(currYear, currMonth + 1, 0).getDate(), // getting last date of month
            lastDayofMonth = new Date(currYear, currMonth, lastDateofMonth).getDay() - 1, // getting last day of month /tilføjede -1
            lastDateofLastMonth = new Date(currYear, currMonth, 0).getDate(); // getting last date of previous month
    let liTag = "";

    for (let i = firstDayofMonth; i > 0; i--) { // creating li of previous month last days
      liTag += `<li class="inactive">${lastDateofLastMonth - i + 1}</li>`;
    }

    for (let i = 1; i <= lastDateofMonth; i++) { // creating li of all days of current month
      // adding active class to li if the current day, month, and year matched
      let isToday = i === date.getDate() && currMonth === new Date().getMonth()
      && currYear === new Date().getFullYear() ? "active" : "";
      liTag += `<li class="${isToday}">${i}</li>`;
    }

    for (let i = lastDayofMonth; i < 6; i++) { // creating li of next month first days
      liTag += `<li class="inactive">${i - lastDayofMonth + 1}</li>`
    }
    currentDate.innerText = `${months[currMonth]} ${currYear}`; // passing current mon and yr as currentDate text
    daysTag.innerHTML = liTag;
  }
  renderCalendar();

  prevNextIcon.forEach(icon => { // getting prev and next icons
    icon.addEventListener("click", () => { // adding click event on both icons
      // if clicked icon is previous icon then decrement current month by 1 else increment it by 1
      currMonth = icon.id === "prev" ? currMonth - 1 : currMonth + 1;

      if(currMonth < 0 || currMonth > 11) { // if current month is less than 0 or greater than 11
        // creating a new date of current year & month and pass it as date value
        date = new Date(currYear, currMonth, new Date().getDate());
        currYear = date.getFullYear(); // updating current year with new date year
        currMonth = date.getMonth(); // updating current month with new date month
      } else {
        date = new Date(); // pass the current date as date value
      }
      renderCalendar(); // calling renderCalendar function
    });
  });

  document.addEventListener('DOMContentLoaded', function () {
    var daysContainer = document.querySelector('.days');

    daysContainer.addEventListener('click', function (event) {
      if (event.target.tagName === 'LI') {
        clickedDay = event.target;

        daysContainer.querySelectorAll('li').forEach(function (day) {
          day.classList.remove('active');
        });

        clickedDay.classList.add('active');

        // Set the selected date in the hidden input field
        document.getElementById('selectedDate').value =
                `${currYear}-${(currMonth + 1).toString().padStart(2, '0')}-${clickedDay.innerText.padStart(2, '0')}`;
      }
    });
  });

  //TODO:TIME!!!!!!!!!!!!!!

  document.addEventListener('DOMContentLoaded', function () {
    const timeDropdown = document.getElementById('timeDropdown');

    if (timeDropdown) {
      const timeEntries = timeDropdown.getElementsByTagName('a');

      // Add click event listener to each time entry
      Array.from(timeEntries).forEach(function (entry) {
        entry.addEventListener('click', function () {
          // Store the clicked time value for later use
          const selectedTime = entry.textContent;
          console.log('Clicked Time Entry:', selectedTime);

          // You can use the selectedTime value as needed, e.g., store it in a variable or send it to the server.
          document.getElementById('selectedTime').value = selectedTime
          document.getElementById("timeDropdown").classList.remove("show");
        });
      });
    }
  });


  document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('appointmentForm');

    if (form) {
      form.onsubmit = async function (event) {
        event.preventDefault(); // Prevent default form submission

        const formData = {
          location: document.getElementById("location").value,
          description: document.getElementById("description").value,
          date: document.getElementById("selectedDate").value, //date
          time: document.getElementById("selectedTime").value,
        };

        console.log("Form Data:", formData);

        try {
          const response = await fetch('http://localhost:8085/appointment', {
            method: 'POST',
            body: JSON.stringify(formData),
            headers: {
              'Content-Type': 'application/json'
            },
          });

          if (!response.ok) {
            throw new Error('Network response was not ok');
          }

          const data = await response.json();
          console.log('Success:', data);

          // Uncomment the line below if you want to redirect after successful submission
          // window.location.href = "/Index.html";
        } catch (error) {
          console.error('Error:', error);
        }
      };
    } else {
      console.error('Form with ID "appointmentForm" not found');
    }
  });






</script>

</body>
</html>

